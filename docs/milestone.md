# 《规范化开发步骤说明》（里程碑 6 阶段）

## 里程碑 1：工程基座与统一规范（可启动、可登录、可鉴权）

- **目标**

  - 搭好三端可启动骨架，统一鉴权与基础规范，为后续业务开发“可持续迭代”打底。
- **涉及端**

  - 后端 Spring Boot
  - 管理后台 Vue3 + Element Plus
  - 微信端 uni-app（小程序）
- **具体任务**

  - 后端：
    - 建立项目结构与模块划分：`auth / user / facility / workorder / maintenancePlan / inventory / stats / file`
    - JWT 鉴权（后台账号密码登录 + 微信端 code 换 openid 绑定用户后发 Token 的流程框架）
    - 统一返回结构、错误码、分页规范
    - RBAC 数据模型与权限拦截骨架（先跑通最小链路）
  - 管理后台：
    - 登录页、Token 存储、基础路由守卫
    - 基础布局（菜单/页头/退出登录），空页面占位各模块入口
  - uni-app：
    - 登录/绑定身份页面骨架（能存 Token）
    - 基础 tab/页面骨架：任务中心/扫码入口/我的（先占位）
- **完成定义（DoD）**

  - 三端都能本地启动
  - 后端提供可用的登录接口（后台登录至少可用），前端能登录并携带 Token 调用一个受保护的示例接口
- **自测点**

  - 后台未登录访问受保护路由会跳转登录
  - Token 过期/无权限返回结构正确
  - 基础分页参数与返回结构可联调
- **产物**

  - 可运行的三端工程骨架
  - 数据库初始化脚本（至少包含用户/角色/权限/用户角色关系）
  - README（环境、启动方式、联调方式）
- **本阶段不做什么**

  - **不做任何业务闭环**（工单、设施、库存等先不实现）
  - **绝不引入地图相关**（包括任何地图 SDK、组件、API）
- 确认说明：
- 里程碑 1 只允许出现：用户 / 角色 / 权限 / 鉴权 / 登录相关表
- 禁止提前创建 facility / workorder / inventory 等业务表
- 业务表必须严格在对应里程碑首次出现

---

## 里程碑 2：设施资产与“一物一码”扫码识别（设施档案可查）

- **目标**
  - 建立设施全生命周期档案的“主数据”，并实现扫码识别进入设施详情/摘要。
- **涉及端**
  - 后端 + 管理后台 + 微信端
- **具体任务**
  - 后端：
    - 设施表（基础字段、状态：启用/停用）
    - 设施 CRUD、设施详情、设施历史入口（先返回空集合也可）
    - 二维码绑定机制：为设施生成唯一编码（或二维码内容字符串），支持查询 `code -> facility`
  - 管理后台：
    - 设施列表/新增/编辑/停用/详情
    - 二维码生成与下载（以“二维码图片文件/下载链接”的形式即可）
  - uni-app：
    - 扫码入口：扫码得到设施 code 后调用后端查设施摘要/详情
    - 展示设施档案摘要与“历史入口”（历史可先是列表占位，下一里程碑补全）
- **完成定义（DoD）**
  - 后台可新增设施并生成二维码
  - 小程序扫码后可展示对应设施信息（至少名称/编号/状态）
- **自测点**
  - 设施停用后扫码提示不可用或只读
  - 非法 code 能正确报错
- **产物**
  - facility 模块接口文档（简版）
  - demo 设施数据 + 对应二维码样例
- **本阶段不做什么**
  - **不做地图展示设施点位**
  - GPS/坐标字段若出现，仅作为字段录入/展示（不做任何距离计算校验）

---

## 里程碑 3：维修工单闭环（必跑通：上报→派单→接单→提交→验收→归档）

- **目标**
  - 交付第一条可验收闭环：维修工单全流程状态机 + 权限控制 + 证据留痕。
- **涉及端**
  - 后端 + 管理后台 + 微信端
- **具体任务**
  - 后端：
    - 工单核心表与状态机（至少 6 态：待派发/已派发/已接单/待验收/已完成/已归档）
    - 维修工单创建来源：微信端上报故障（绑定设施）
    - 状态流转规则：谁能从 A 到 B；每个关键动作必填校验（提交必须：文字+≥1图片+服务器时间戳+经纬度字段）
    - 工单操作日志/流程节点记录（用于全流程追踪与审计）
    - 文件上传与“工单证据”绑定（图片至少）
  - 管理后台：
    - 工单列表（按状态筛选）、工单详情（流程节点/日志）
    - 派单/转派、验收、归档
    - 设施详情中能看到维修历史列表（从工单数据回挂）
  - uni-app：
    - 故障上报：扫码选择设施后发起上报（生成待派发工单）
    - 任务中心：待办/处理中/待提交/已完成
    - 工单详情：接单、到场扫码确认、填写处理记录、上传图片、提交
- **完成定义（DoD）**
  - 严格按文档“维修闭环演示”可完整演示一遍并落库
  - 验收后工单不可再编辑；归档后不可编辑
- **自测点**
  - **状态机约束**：越权流转、非法流转必须被拦截
  - **必填约束**：提交无图片/无文字/无经纬度字段时必须失败
  - 文件上传失败重试（可先做到“失败提示 + 可重新提交”）
  - 设施历史能查到刚完成的工单
- **产物**
  - workorder 模块接口清单 + 状态机说明（含角色权限矩阵）
  - 测试账号（管理员/执行者/上报者）与一套演示数据
- **本阶段不做什么**
  - **不做保养计划**（定时任务不做）
  - **不做库存联动**
  - **不做任何地图展示/导航/路线规划/地理编码**（经纬度只存字段）

---

## 里程碑 4：保养计划 + 定时任务自动生成保养工单（第二条闭环）

- **目标**
  - 交付第二条可验收闭环：后台建计划 → 定时生成保养工单 → 派发执行 → 验收归档。
- **涉及端**
  - 后端 + 管理后台 + 微信端
- **具体任务**
  - 后端：
    - 保养计划表/模板/检查项（最小可用：周期、适用设施/类别、检查项文本）
    - 定时任务：扫描到期计划生成保养工单
    - 幂等：同一计划同一周期不重复生成
    - 生成工单后进入待派发队列（或指定派发策略：默认待派发）
  - 管理后台：
    - 保养计划管理：新增/编辑/启停、查看下一次生成时间（可简化）
    - 保养工单在工单列表中可识别类型（维修/保养）
  - uni-app：
    - 保养工单执行与提交复用维修工单提交流程（文字+图片+时间戳+经纬度字段）
- **完成定义（DoD）**
  - 严格按文档“保养闭环演示”可完整演示一遍
  - 定时任务能稳定生成且不重复
- **自测点**
  - 手动触发一次计划扫描（用于本地演示）与定时触发都能生成
  - 幂等校验：重复触发不新增重复工单
  - 保养工单与设施历史关联可查
- **产物**
  - maintenancePlan 模块接口说明 + 定时任务说明（含幂等策略描述）
- **本阶段不做什么**
  - **不引入任何地图能力**
  - 不做复杂通知体系（可先仅后台列表可见，不做微信订阅消息）

---

## 里程碑 5：库存备件最小可用 + 工单消耗关联

- **目标**
  - 实现库存“可管、可预警、可追溯到工单”的最小版本，满足验收要求。
- **涉及端**
  - 后端 + 管理后台（uni-app 可选仅展示/不做操作）
- **具体任务**
  - 后端：
    - 备件台账、入库/出库流水
    - 库存预警（阈值字段 + 查询接口）
    - 工单消耗关联：工单提交时可记录消耗备件及数量（允许简化：只在后台录入也行）
  - 管理后台：
    - 备件列表、入库、出库、库存预警列表
    - 工单详情展示消耗备件记录
- **完成定义（DoD）**
  - 能创建备件、入库后库存增加、出库后减少
  - 库存低于阈值能在预警列表中看到
  - 任一已完成工单能关联并展示其备件消耗记录
- **自测点**
  - 出库数量大于库存的拦截
  - 并发/重复提交的基本防护（最小：后端校验 + 事务）
- **产物**
  - inventory 模块接口清单 + demo 备件数据
- **本阶段不做什么**
  - 不做复杂仓库/批次/序列号管理
  - **不做任何地图或位置可视化**

---

## 里程碑 6：统计分析最小可用 + 最终验收与回归测试

- **目标**
  - 交付可演示的关键指标看板，并完成两条闭环的回归验证与最终验收资料。
- **涉及端**
  - 后端 + 管理后台（uni-app 可展示个人统计）
- **具体任务**
  - 后端：
    - 指标接口至少 2~3 个：完成率、平均修复时长、故障高发设施（TopN）
    - 统计口径固定（按时间范围、按工单类型、按人员可选）
  - 管理后台：
    - 指标看板页面 + 报表列表（导出可选）
    - GPS/时间戳/提交人等审计字段在工单记录中可表格查看
  - uni-app：
    - “我的”页面展示个人完成数量、平均耗时等（复用同一统计接口或单独接口）
  - 文档与验收：
    - 最终 README：三端启动、测试账号、两条闭环演示步骤、预期结果
    - 回归测试清单：状态机、权限、上传、幂等、必填校验
- **完成定义（DoD）**
  - 后台能看到指标并与 demo 数据一致
  - 两条闭环再次完整跑通（回归）且关键约束都生效（必填、权限、不可编辑）
- **自测点**
  - 指标时间范围筛选正确
  - 角色切换后菜单与接口权限正确
  - 工单归档后编辑接口不可用
- **产物**
  - stats 模块接口说明
  - 最终验收文档（README + 测试用例清单）
- **本阶段不做什么**
  - 不做复杂 BI、大屏、地图热力图/点位图（**严格禁止**）

---

# 全程统一“禁止事项清单”（每个里程碑都适用）

- **禁止地图底图加载**（腾讯/高德/百度/Google 等）
- **禁止 marker/聚合/热力图/轨迹/围栏/导航/路线规划**
- **禁止正逆地理编码**
- **禁止任何外部地图 API 付费调用**
- **允许 GPS**：仅在提交时采集并保存，经纬度只做**字段/表格展示**，不渲染地图

---

# 当前状态（请你确认）

- **我已完成**：逐条阅读并按文档输出了 6 阶段里程碑《规范化开发步骤说明》
- **下一步需要你确认**：
  - 你是否认可“6 个里程碑”的拆分与每阶段 DoD
  - 工单状态机是否按文档 6 态执行（或你希望我增加/调整状态，如“已驳回/补充材料”等）

你确认后，我才会开始进入 **里程碑 1** 的编码工作，并且每完成一个里程碑我都会停下提示你测试。
